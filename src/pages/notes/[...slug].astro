---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

interface Props {
  tags: CollectionEntry<"tags">[];
  note: CollectionEntry<"notes">;
}

export async function getStaticPaths() {
  const tagsCollection = await getCollection("tags");
  const notes = await getCollection("notes");

  return notes
    .map((note) => {
      const tags = tagsCollection.filter((tag) =>
        note.data.tags.includes(tag.data.title)
      );

      return tags.map((tag) => ({
        params: { slug: `${tag.slug}/${note.slug}` },
        props: { tags, note },
      }));
    })
    .reduce((prev, curr) => [...prev, ...curr], []);
}

const { tags, note } = Astro.props;
const { Content } = await note.render();
---

<Layout title={note.data.title}>
  <h1>{note.data.title}</h1>
  <p class="italic">
    Tags: {
      tags.map((tag) => (
        <a class="mr-2" href={`/notes/${tag.slug}`}>
          {tag.data.title}
        </a>
      ))
    }
  </p>
  <Content />
</Layout>

<style></style>
