---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const allTags = await getCollection("tags");
const notes = await getCollection("notes");
const sortedTags = allTags
  .sort((a, b) => a.data.title.localeCompare(b.data.title))
  .map((tag) => ({
    ...tag,
    data: {
      ...tag.data,
      notes: notes.filter((note) => note.data.tags.includes(tag.data.title)),
    },
  }));
const title = "📃 Notes";
---

<Layout title={title}>
  <h1>{title}</h1>
  <section class="space-y-12">
    {
      sortedTags.map((tag) => (
        <article>
          <h2>🏷️ {tag.data.title}</h2>
          <section class="space-y-4">
            {tag.data.notes.map((note) => (
              <article>
                <a href={`/notes/${tag.slug}/${note.slug}`}>
                  {note.data.title}
                </a>
              </article>
            ))}
          </section>
        </article>
      ))
    }
  </section>
</Layout>

<style></style>
